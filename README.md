# AI 이미지 유사도 분석 도구

AI 생성 이미지와 실제 이미지 간의 유사도를 정량적으로 분석하고 시각화하는 종합 도구입니다. 다양한 이미지 편집 기능과 함께 고급 배경 제거 기술을 제공하여 더욱 정확한 이미지 비교를 가능하게 합니다.

## ✨ 주요 기능

### 🔍 이미지 유사도 분석
- **🧠 LPIPS (Learned Perceptual Image Patch Similarity)**: 인간의 시각적 인지 과정을 모방한 최첨단 유사도 측정
  - AlexNet 기반 기본 모드와 AlexNet+VGG 앙상블 모드 지원
  - 기존 메트릭보다 인간의 판단과 높은 상관관계
  - 이미지 품질 평가와 생성 모델 성능 측정에 특화
- **SSIM (Structural Similarity Index)**: 이미지의 구조적 유사성 측정
- **PSNR (Peak Signal-to-Noise Ratio)**: 픽셀 단위 차이 정량화  
- **VGG16 기반 코사인 유사도**: 사전 학습된 딥러닝 모델을 활용한 고수준 특징 비교
- **🎯 선택적 메트릭**: 필요한 유사도 메트릭만 선택하여 계산 가능
- **📊 향상된 결과 표시**: 시각적 프로그레스 바와 상세한 결과 해석 가이드
- 결과 저장 및 비교 조회 기능
- 그래프 및 통계를 통한 데이터 분석
- 코멘트 기능을 통한 정성적 평가 기록

### 🎨 고급 이미지 편집 기능
- **AI 기반 배경 제거**: `rembg` 라이브러리를 활용한 정확한 배경 제거
- **🎯 영역 지정 배경 제거**: 사각형 또는 다각형 영역을 지정하여 부분적으로 배경 제거
- **이미지 변형**: 회전, 좌우반전, 크기 조정
- **색상 조정**: 밝기, 대비, 색상 채도, 선명도 조절
- **실시간 미리보기**: 편집 결과를 즉시 확인 가능

### 🎯 영역 지정 배경 제거 기능 상세

#### 혁신적인 마스킹 시스템
- **사각형 영역**: 직관적인 좌표 입력으로 사각형 영역 지정
- **다각형 영역**: 복잡한 형태의 자유로운 다각형 영역 지정  
- **빠른 설정 템플릿**: 중앙, 상단, 좌측, 전체 등 미리 설정된 영역
- **다각형 템플릿**: 삼각형, 다이아몬드, 별모양 등 다양한 패턴

#### 고급 마스크 옵션
- **마스크 영역 반전**: 선택 영역 외부에만 배경 제거 적용
- **임계값 조정**: rembg 미사용 시 정밀한 배경 제거 설정
- **실시간 미리보기**: 설정 변경 시 즉시 결과 확인

#### 사용 예시
```
📐 사각형 영역: 인물의 얼굴 부분만 배경 제거
🔺 다각형 영역: 복잡한 객체 형태에 맞춰 정밀 배경 제거
🔄 영역 반전: 배경은 유지하고 특정 객체만 제거
```

### 🖼️ 전체 배경 제거 기능

#### 기술적 특징
- **AI 기반 처리**: `rembg` 라이브러리의 최신 딥러닝 모델 사용
- **자동 객체 인식**: 사람, 동물, 사물 등 다양한 객체 자동 감지
- **고품질 결과**: 머리카락, 털, 반투명 객체까지 정확하게 처리
- **실시간 처리**: 라디오 버튼 선택 시 즉시 배경 제거 및 미리보기 제공

#### 사용 방법
1. **이미지 업로드**: 실제 사진 또는 AI 생성 사진 업로드
2. **배경 설정 선택**: 
   - `원본 유지`: 기존 이미지 그대로 사용
   - `전체 배경 제거`: AI가 자동으로 전체 배경을 제거하고 투명 처리
   - `영역 지정 배경 제거`: 특정 영역에만 배경 제거 적용
3. **실시간 미리보기**: 선택 즉시 처리 결과 확인
4. **유사도 비교**: 배경이 제거된 이미지로 정확한 유사도 측정

#### 장점
- **정확한 비교**: 배경 노이즈 제거로 객체 중심의 정확한 유사도 측정
- **일관된 조건**: 동일한 배경 조건에서 공정한 이미지 비교
- **투명 배경 지원**: RGBA 형식으로 투명 배경 이미지 생성
- **오류 복구**: rembg 실패 시 임계값 기반 방식으로 자동 대체

#### 기술적 구현
```python
# AI 기반 배경 제거 (rembg 사용)
from rembg import remove
output = remove(input_image)  # 자동으로 배경 제거

# 영역 지정 배경 제거
def remove_background_with_mask(image, mask_coords, mask_type):
    # 사각형 또는 다각형 마스크 생성
    mask = create_mask(image.size, mask_coords, mask_type)
    # 마스크된 영역에만 배경 제거 적용
    return apply_selective_background_removal(image, mask)

# Fallback: 임계값 기반 배경 제거
mask = np.all(img_array > threshold, axis=2)
rgba[:, :, 3] = np.where(mask, 0, 255)  # 투명도 적용
```

### 🛡️ 안전한 이미지 처리
- **크기 제한 관리**: 대용량 이미지 자동 리샘플링으로 보안 강화
- **메모리 최적화**: 효율적인 이미지 처리로 안정적인 성능
- **오류 복구**: 이미지 로드 실패 시 사용자 친화적인 오류 메시지

### 📊 결과 관리
- **결과 저장**: 분석 결과를 데이터베이스에 자동 저장
- **결과 조회**: 저장된 분석 결과 검색 및 조회
- **통계 분석**: 전체 분석 결과의 통계 및 시각화
- **코멘트 기능**: 정성적 평가 기록 및 관리

## 🚀 설치 및 실행 방법

### 1. 필요 라이브러리 설치
```bash
pip install -r requirements.txt
```

### 2. 애플리케이션 실행
```bash
streamlit run app.py
```

## 📦 주요 의존성

```
streamlit==1.28.1          # 웹 애플리케이션 프레임워크
opencv-python==4.8.1.78    # 이미지 처리
Pillow==10.0.1             # 이미지 조작
numpy==1.24.3              # 수치 연산
scikit-image==0.21.0       # 이미지 분석
matplotlib==3.7.2          # 데이터 시각화
seaborn==0.12.2            # 통계 시각화
pandas==2.0.3              # 데이터 분석
rembg==2.0.50              # AI 기반 배경 제거
```

## 🎯 사용 방법

### 유사도 비교
1. **이미지 업로드**: 실제 이미지와 AI 생성 이미지를 업로드
2. **이미지 편집**: 필요시 배경 제거 및 다양한 편집 적용
3. **유사도 측정**: 세 가지 알고리즘으로 종합적인 유사도 분석
4. **결과 확인**: 시각적 게이지와 상세 점수로 결과 확인

### 결과 조회
- 저장된 분석 결과 검색 및 필터링
- 이미지별, 날짜별, 점수별 정렬 가능

### 결과 요약  
- 전체 분석 결과의 통계 대시보드
- 그래프를 통한 트렌드 분석

## 📈 분석 지표 설명

### 🧠 LPIPS (Learned Perceptual Image Patch Similarity)
- **범위**: 0% ~ 100% (높을수록 유사)
- **특징**: 인간의 시각적 인지 과정을 모방한 학습된 메트릭
- **기술**: AlexNet 또는 VGG 백본 네트워크 기반 지각적 거리 측정
- **용도**: 이미지 생성 모델 평가, 인간 판단과 높은 상관관계
- **모드**: 기본(AlexNet), 앙상블(AlexNet+VGG)

### SSIM (Structural Similarity Index)
- **범위**: 0% ~ 100%
- **특징**: 인간의 시각 인식과 유사한 구조적 비교
- **용도**: 이미지 압축, 화질 평가

### PSNR (Peak Signal-to-Noise Ratio)  
- **단위**: dB (데시벨)
- **특징**: 픽셀 단위의 정량적 차이 측정
- **용도**: 객관적 화질 평가

### VGG16 기반 코사인 유사도
- **범위**: 0% ~ 100% 
- **특징**: 딥러닝 모델의 고수준 특징 비교
- **용도**: 의미적 내용 유사성 평가

## 🔧 기술 스택

- **Frontend**: Streamlit
- **Backend**: Python
- **이미지 처리**: OpenCV, PIL, scikit-image
- **AI 모델**: 
  - VGG16 (PyTorch) - 특징 추출
  - LPIPS - 지각적 유사도 측정
  - rembg - AI 배경 제거
  - SwinIR - 이미지 업스케일링
- **메모리 관리**: psutil - 대용량 이미지 처리 최적화
- **데이터베이스**: SQLite
- **시각화**: Matplotlib, Seaborn

## 🛠️ 프로젝트 구조

```
Image-Similarity-Analyzer/
├── app.py                 # 메인 애플리케이션
├── requirements.txt       # 의존성 패키지
├── README.md             # 프로젝트 문서
├── pages/                # 페이지 모듈
│   ├── image_comparison.py    # 이미지 비교 페이지
│   ├── results_viewer.py      # 결과 조회 페이지
│   └── results_summary.py     # 결과 요약 페이지
├── image_processing.py    # 이미지 처리 함수
├── similarity_metrics.py  # 유사도 계산 함수
├── ui_components.py      # UI 컴포넌트
├── db_utils.py          # 데이터베이스 유틸리티
└── Result/              # 결과 이미지 저장 폴더
```

## 📝 라이센스

이 프로젝트는 MIT 라이센스 하에 제공됩니다.

## 🤝 기여하기

1. 프로젝트를 포크합니다
2. 새로운 기능 브랜치를 생성합니다 (`git checkout -b feature/새기능`)
3. 변경사항을 커밋합니다 (`git commit -am '새 기능 추가'`)
4. 브랜치에 푸시합니다 (`git push origin feature/새기능`)
5. Pull Request를 생성합니다

## 📞 지원

문제가 발생하거나 기능 요청이 있으시면 이슈를 생성해 주세요.